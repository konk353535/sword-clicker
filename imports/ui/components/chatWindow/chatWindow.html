<template name="chatWindow">
  {{#if minimized}}
    <button class="btn btn-secondary btn-sm maximize-icon">Show Chat</button>
  {{/if}}
  <div class="chat-container
    {{#if isChatPage}}
      is-chat-page
    {{else}}
      {{#if minimized}}
        minimized
      {{/if}}
    {{/if}}
    mx-2">

    {{#unless minimized}}
      <img src="/icons/minimize.svg" class="minimize-icon minimize-btn extra-small-icon hidden-sm-down">
    {{/unless}}
    <div class="box-body chat-scroll">
      <!-- Conversations are loaded here -->
      <div class="direct-chat-messages">
          <div class="scroll-height">
              {{#unless Template.subscriptionsReady}}
                <div class="" style="height: 34px; width: 64px; margin: auto">
                  {{>spinner}}
                </div>
              {{else}}
                {{#if hasMore}}
                  <button class="btn btn-block btn-default" id="simple-chat-load-more">
                    Load More
                  </button>
                {{/if}}
              {{/unless}}
              <!-- Message. Default to the left -->
              {{#each simpleChats}}
                  {{#if message}}
                      {{#if wantCondensedChat}}
                          <div class="direct-chat-msg {{#if me}}right{{/if}} {{#unless viewedMe}}notViewed{{/unless}}"
                               id="{{_id}}">
                              <div class="direct-chat-text chat-{{this.custom.roomType}}">
                                  <span class="direct-chat-timestamp" style="margin-left: 0px;">
                                    {{moFormat date "ddd hh:mma"}}
                                  </span>
                                  {{#if this.isAdmin}}
                                    <span style="margin: 0px;"><img src="/icons/cat.svg" style="height: 18px; margin: 0px;" /></span>
                                  {{/if}}
                                  {{#if this.avatar}}
                                    <span style="margin: 0px;"><img src="{{this.avatar}}" style="height: 18px; margin: 0px;" /></span>
                                  {{/if}}
                                  {{#if $eq name 'Game'}}
                                    <span class="direct-chat-name chat-{{this.custom.roomType}}">
                                      {{name}}
                                    </span>
                                  {{else if $eq name 'SERVER'}}
                                    <span class="direct-chat-name chat-{{this.custom.roomType}}">
                                      {{name}}
                                    </span>
                                  {{else}}
                                    <a href="/profile/{{name}}">
                                      <span class="direct-chat-name chat-{{this.custom.roomType}}">
                                        {{name}}
                                      </span>
                                    </a>
                                  {{/if}}
                                  <!-- /.direct-chat-info -->
                                  {{{message}}}
                                  {{#if me}}
                                      <div class="direct-chat-checks">
                                          {{#if sent}}
                                              {{#if showReceived }}
                                                  <i class="icon-check {{#if viewedAll}}chat-viewed{{/if}}"></i>
                                                  {{#if receivedAll}}
                                                      <i class="icon-check {{#if viewedAll}}chat-viewed{{/if}}"></i>
                                                  {{/if}}
                                              {{/if}}
                                          {{else}}
                                              <i class="icon-clock"></i>
                                          {{/if}}

                                      </div>
                                  {{/if}}
                              </div>
                              <!-- /.direct-chat-text -->
                          </div>
                      {{else}}
                          <div class="direct-chat-msg {{#if me}}right{{/if}} {{#unless viewedMe}}notViewed{{/unless}}"
                               id="{{_id}}">
                              <div class="direct-chat-info clearfix">
                                {{#if this.isAdmin}}
                                  <span style="margin: 0px;"><img src="/icons/cat.svg" style="height: 18px; margin: 0px;" /></span>
                                {{/if}}
                                {{#if this.avatar}}
                                  <span style="margin: 0px;"><img src="{{this.avatar}}" style="height: 18px; margin: 0px;" /></span>
                                {{/if}}
                                {{#if $eq name 'Game'}}
                                  <span class="direct-chat-name pull-left chat-{{this.custom.roomType}}">
                                    {{name}}
                                  </span>
                                {{else if $eq name 'SERVER'}}
                                  <span class="direct-chat-name pull-left chat-{{this.custom.roomType}}">
                                    {{name}}
                                  </span>
                                {{else}}
                                  <a href="/profile/{{name}}">
                                    <span class="direct-chat-name pull-left chat-{{this.custom.roomType}}">
                                      {{name}}
                                    </span>
                                  </a>
                                {{/if}}
                                <span class="direct-chat-timestamp">
                                  {{moFormat date "MMM Do hh:mma"}}
                                </span>
                              </div>
                              <!-- /.direct-chat-info -->
                              <div class="direct-chat-text chat-{{this.custom.roomType}}">
                                  {{{message}}}
                                  {{#if me}}
                                      <div class="direct-chat-checks">
                                          {{#if sent}}
                                              {{#if showReceived }}
                                                  <i class="icon-check {{#if viewedAll}}chat-viewed{{/if}}"></i>
                                                  {{#if receivedAll}}
                                                      <i class="icon-check {{#if viewedAll}}chat-viewed{{/if}}"></i>
                                                  {{/if}}
                                              {{/if}}
                                          {{else}}
                                              <i class="icon-clock"></i>
                                          {{/if}}

                                      </div>
                                  {{/if}}
                              </div>
                              <!-- /.direct-chat-text -->
                          </div>
                      {{/if}}
                  {{/if}}
                  <!-- /.dir-->
              {{/each}}
          </div>
      </div>
      <!--/.direct-chat-messages-->
    </div>
    <!-- /.box-body -->
    <div class="box-footer">
      <div class="dropup">
        <button type="button" class="btn btn-secondary hidden-sm-down chat-type-dropdown dropdown-toggle {{currentChat.class}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          {{currentChat.name}}
        </button>
        <div class="dropdown-menu">
          {{#each availableChats}}
            <div class="d-flex align-items-center">
            <a class="dropdown-item change-chat {{this.class}}" href="#" data-chat-id="{{this.id}}">
              {{this.name}}
            </a>
            {{#if this.show}}
              <button class="btn btn-link mx-1 btn-hide-chat" data-id="{{this.id}}">
                <small>Hide</small>
              </button>
            {{else}}
              <button class="btn btn-link mx-1 btn-show-chat" data-id="{{this.id}}">
                <small>Show</small>
              </button>              
            {{/if}}
            </div>
          {{/each}}
        </div>
      </div>

      <input
        type="text"
        name="message"
        placeholder="{{placeholder}}"
        class="form-control"
        autocomplete="off"
        id="simple-chat-message">

      <div class="d-flex flex-grow message-mobile-info">
        <div class="dropup">
          <button type="button" class="btn btn-secondary btn-sm hidden-md-up dropdown-toggle {{currentChat.class}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {{currentChat.name}}
          </button>
          <div class="dropdown-menu">
            {{#each availableChats}}
              <div class="d-flex align-items-center">
              <a class="dropdown-item change-chat {{this.class}}" href="#" data-chat-id="{{this.id}}">
                {{this.name}}
              </a>
              {{#if this.show}}
                <button class="btn btn-link mx-1 btn-hide-chat" data-id="{{this.id}}">
                  <small>Hide</small>
                </button>
              {{else}}
                <button class="btn btn-link mx-1 btn-show-chat" data-id="{{this.id}}">
                  <small>Show</small>
                </button>              
              {{/if}}
              </div>
            {{/each}}
          </div>
        </div>
        {{#unless minimized}}
          <button class="btn btn-sm btn-secondary hidden-md-up ml-3 minimize-btn" id="message-hide">Hide</button>
        {{/unless}}

        <div class="d-flex flex-grow justify-content-end">
          <button class="btn btn-sm btn-secondary btn-send" id="message-send">Send</button>
        </div>
      </div>
    </div>
    <!-- /.box-footer-->

  </div>
</template>

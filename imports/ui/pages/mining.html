<template name="miningPage">
  <div class="container mt-2">

    <div class="row">
      <div class="col-md-6">
        <!-- Mining Carts -->
        <div class="d-flex align-items-center">
          <div class="text-muted mr-2">
            Mining Carts
          </div>
        </div>
        {{> miningCollector}}

        <!-- Prospecting -->
        <div class="d-flex mt-3 align-items-center">
          <div class="text-muted mr-2">
            Prospecting
          </div>
        </div>
        <div class="d-flex flex-wrap">
          {{#each mining.prospecting}}
            <div class="icon-box hoverable-blue item-icon-container small ml-0 mr-1 select-prospector cursor-pointer" data-index="{{@index}}">
              <img src="/icons/{{this}}.png" class="ore-icon">
            </div>
          {{/each}}
          {{#each emptyProspectingSpaces}}
            <div class="icon-box hoverable-blue item-icon-container small ml-0 mr-1 select-prospector cursor-pointer" data-index="new">
              Set
            </div>
          {{/each}}
        </div>
        {{#if isSelectingProspector}}
          <hr />
          <div class="d-flex flex-wrap">
            {{#each oresList}}
              <div
                class="icon-box hoverable-blue cursor-pointer item-icon-container small ml-0 mr-1 select-ore-to-prospect {{#if this.prospecting}}leader-icon{{/if}}"
                data-id="{{this.name}}"
              >
                <img src="/icons/{{this.icon}}" class="ore-icon">
              </div>
            {{/each}}
          </div>
        {{/if}}

        <!-- Gear -->
        <div class="d-flex mt-3 align-items-center">
          <div class="text-muted mr-2">
            Gear
          </div>
          <a href="#" class="edit-mining-gear">
            <small>
              {{#if editingMiningGear}}
                cancel
              {{else}}
                edit
              {{/if}}
            </small>
          </a>
        </div>
        <div class="d-flex flex-row flex-wrap">
          {{#if equippedItemsMap.pickaxe}}
            <div class="d-flex flex-column align-items-center justify-content-center equipped-pickaxe">
              {{> itemIcon item=equippedItemsMap.pickaxe classes="small"}}
            </div>
          {{else}}
            <div class="icon-box small">
              Pickaxe
            </div>
          {{/if}}
          {{#if equippedItemsMap.mining_offhand}}
            <div class="d-flex flex-column align-items-center justify-content-center equipped-mining-offhand">
              {{> itemIcon item=equippedItemsMap.mining_offhand classes="small"}}
            </div>
          {{else}}
            <div class="item-icon-container icon-box small">
              Offhand
            </div>
          {{/if}}
        </div>
        {{#if editingMiningGear}}
          <hr />
          <!-- Show inventory of pickaxes / ect -->
          <div class="d-flex flex-wrap">
            {{#each miningPickaxes}}
              {{> itemIcon item=this classes="small"}}
            {{/each}}
          </div>
        {{/if}}

        <!-- Miners -->
        <div class="d-flex mt-3 align-items-center">
          <div class="text-muted mr-2">
            Miners
          </div>
        </div>
        <div class="d-flex flex-wrap mt-1">
          {{#each buyableMiners}}
            {{> buyableMiner miner=this}}
          {{/each}}
        </div>
      </div>
      <div class="col-md-6">
        <!-- Mine Pit -->
        <div class="d-flex flex-grow justify-content-center align-items-center">
          <div style="max-width: 352px">
            <div class="d-flex" style="justify-content: space-between;">
              <div class="d-flex">
                <div class="mr-1">Energy</div>
                <div class="text-warning">{{> formatNumber number=mining.stats.energy}}</div>
              </div>
              <div class="d-flex">
                <div class="mr-1">Click</div>
                <div class="text-danger">{{> formatNumber number=mining.stats.attack}}</div>
              </div>
              <div class="d-flex">
                <div class="mr-1">DPH</div>
                <div class="text-info">{{> formatNumber number=totalDPH}}</div>
              </div>
            </div>

            <div class="d-flex flex-row flex-wrap mt-1">
              {{#each miningSpaces}}
                {{> mineSpace mineSpace=this multihit=miningMultihit}}
              {{/each}}
            </div>

            <div style="margin-top: 50px">
              {{> skillHeader skill=miningSkill small=true}}
            </div>

            <div style="margin-top: 10px">
              <div class="d-flex flex-wrap">
                {{#each oresList}}
                  <div class="d-flex icon-box-border mr-1 mt-1 p-2" style="width: 75px">
                    <div class="ore-list-item align-items-center d-flex">
                      <img src="/icons/{{this.icon}}" class="extra-small-icon mr-1">
                      <div>{{this.amount}}</div>
                    </div>
                  </div>
                {{/each}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    {{#if $eq currentTab 'prospectors'}}

      {{#if $gte summaryProspectors.count 3}}
        <div class="my-3"><b>Prospectors increase the speed at which ores spawn.</b></div>
      {{/if}}

      <table class="table table-bordered table-centered table-responsive">
        <thead>
          <tr>
            <th>Name</th>
            <th class="hidden-md-down">Icon</th>
            <th>Requirements</th>
            <th>Count</th>
            <th>Actions</th>
          </tr>  
        </thead>
        <tbody>
          {{#each buyableProspectors}}
            <tr class="prospector-row text-center">
              <td class="text-capitalize">{{this.name}}</td>
              <td class="hidden-md-down">
                <img src="/icons/{{this.icon}}" class="ore-icon">
              </td>
              <td>{{ > requiredItems requiredItems=this.required}}</td>
              <td>{{this.amount}} / {{this.max}}</td>
              <td>
                <button class="btn btn-primary m-1 prospector-hire" data-prospector={{this.id}}>
                  Hire
                </button>
                <button class="btn btn-danger m-1 prospector-fire" data-prospector={{this.id}}>
                  Fire
                </button>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{/if}}
  </div>
</template>

<template name="hireMinerButton">

  {{#if $lt recipe.amount 3}}
    <!--
    <div>{{ > requiredItems requiredItems=this.required}}</div>
    <div>{{this.amount}} / {{this.max}}</div>-->
    <button class="btn btn-primary hire-miner">
      <span class="px-1">Hire</span>
    </button>
  {{/if}}

  {{#if showModal}}
    <div class="modal hireMinerModal" tabindex="-1" role="dialog" aria-labelledby="hireMinerModal" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <div class="d-flex flex-column">
              <h5 class="modal-title text-capitalize">
                {{recipe.name}}
              </h5>
              <small>{{recipe.description}}</small>
            </div>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form class="craft-amount-form">
            <div class="modal-body">
              {{ > requiredItemsList requiredItems=recipe.required recipeName=recipe.name duration=0}}

              {{#if recipe.baseStats}}
                {{#if showStats}}
                  <a href="#" class="hide-stats">Hide Stat Range</a>
                  {{> displayCombatStats stats=recipe.baseStats extraStats=recipe.extraStats}}
                  {{#if recipe.requiredEquip}}
                    <b>Equip Requirements</b>
                    <div class="d-flex flex-wrap">
                      {{#each recipe.requiredEquip}}
                        <i class="lilIcon-{{this.name}} extra-small-icon mx-1"></i>
                        {{this.level}}
                      {{/each}}
                    </div>
                  {{/if}}
                  {{#if recipe.isTwoHanded}}
                    <b>Two Handed</b>
                  {{/if}}
                {{else}}
                  <a href="#" class="show-stats">Show Stat Range</a>
                {{/if}}
              {{/if}}          
            </div>
            <div class="modal-footer">
              <div style="display: flex; flex: 1 1 auto;">
              </div>
              <button type="button" class="btn btn-primary confirm-hire-miner">
                Hire
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  {{/if}}
</template>

<template name="buyableMiner">
  <div class="buy-miner" data-miner="{{miner.id}}"
    style="border: 1px solid black; padding: 10px; margin: 0 10px 10px 0; min-width: calc(50% - 20px); flex: 1 1 auto;">
    <div class="d-flex flex-wrap">
      <img src="/icons/{{miner.icon}}" class="medium-icon">
      <div class="mx-3 d-flex flex-column">
        <div class="text-capitalize">{{miner.name}}</div>
        <span class="damage-per-hour-container" style="min-width: 120px">
          {{#if miner.amount}}
            <div>DPH:
              <span class="text-info">
                {{> ceilNumber miner.damagePerHour}}
              </span>
            </div>
          {{else}}
            <div style="color: #DFDFDF">
              DPH: {{> ceilNumber miner.damagePerHour}}
            </div>
          {{/if}}
        </span>
      </div>
      <div class="mx-3" style="flex: 1 1; align-items: center;">
        <div class="d-flex">
          <div class="d-flex flex-grow">Level: {{miner.level}}</div>
          {{#if $lt miner.amount 3}}
            <div class="d-flex flex-grow">
              Miners: {{miner.amount}} / 3
            </div>
          {{/if}}
        </div>
        <div style="flex: 1 1 auto; display: flex; align-items: center; height: 50%">
          <div class="progress" style="height: 16px; flex: 1 1 auto;">
            <div class="progress-bar" role="progressbar" style="width: {{miner.xpPercentage}}%;" aria-valuenow="{{miner.xpPercentage}}" aria-valuemin="0" aria-valuemax="100">
              {{> formatNumber number=miner.xp decimal=1}} / {{miner.xpToLevel}}
            </div>
          </div>
        </div>
      </div>
      {{> hireMinerButton recipe=miner}} 
    </div>
  </div>

  <div class="dps-breakdown-tooltip-content my-tooltip-inner">
    <h3 class='popover-title text-capitalize'>DPS Breakdown</h3>
      <div class='popover-content'>
        Base DPS: {{> ceilNumber miner.baseDamagePerHour}}<br />
        Level Bonus: {{> ceilNumber miner.levelDps}}<br />
        Idol Bonus: {{> ceilNumber miner.minerStatDps}}<br />
        {{#if miner.donatorDps}}
          Donator Bonus: {{> ceilNumber miner.donatorDps}}
        {{/if}}
      </div>
    </div>
</template>

<template name="miningCollector">
  <div class="d-flex flex-wrap">
    {{#each collectors}}
      <div class="d-flex icon-box-border mr-1 mt-1 p-2">
        <div class="ore-list-item align-items-center d-flex">
          <img src="/icons/{{this.key}}.png" class="extra-small-icon mr-1">
          <div>{{this.amount}} / 100</div>
        </div>
      </div>
    {{else}}
      <div class="text-muted">Empty</div>
    {{/each}}
    {{#if collectors}}
      <div class="d-flex align-items-center mt-1 ml-1">
        <button class="btn btn-primary collect-ores">
          Collect
        </button>
      </div>
    {{/if}}
  </div>
</template>

<template name="oreListItem">
  <div class="ore-list-item">
    <img src="/icons/{{ore.icon}}" class="icon-box small-icon"> {{ore.amount}}
  </div>

  <div class="ore-list-item-tooltip-content my-tooltip-inner">
    <h3 class='popover-title text-capitalize'>{{ore.name}}</h3>
  </div>
</template>
